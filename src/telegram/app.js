process['env']['LOGLEVEL']='none',require('dotenv')['config']();const fs=require('fs'),path=require('path'),readline=require('readline'),{parseMessage}=require('./utils'),{Client,Storages,Raw}=require('@tgsnake/core'),{placeBet}=require('../coinryze/app.js'),{apiId,apiHash,phoneNumber,password,signalChannel}=require('../../config/telegram'),sessionFilePath=path['join'](__dirname,'session.txt');async function startTelegramClient(_0x3ca9ab){const _0x5db44f=fs['existsSync'](sessionFilePath)?fs['readFileSync'](sessionFilePath,'utf8'):'',_0x45e30c=new Storages['StringSession'](_0x5db44f),_0x1c7bac=readline['createInterface']({'input':process['stdin'],'output':process['stdout']}),_0x474df4=()=>new Promise(_0xec03a9=>_0x1c7bac['question']('Please\x20enter\x20the\x20code\x20you\x20received:\x20',_0xec03a9)),_0x3ffcef=new Client(_0x45e30c,apiHash,apiId);try{if(!_0x5db44f){console['log']('Starting\x20Telegram\x20client...'),await _0x3ffcef['start']({'phoneNumber':async()=>phoneNumber,'password':async()=>password,'code':_0x474df4,'authError':_0x373b3b=>console['error']('Error\x20during\x20authorization:',_0x373b3b)});const _0x56ed17=await _0x3ffcef['exportSession']();fs['writeFileSync'](sessionFilePath,_0x56ed17),console['log']('Session\x20saved\x20to\x20session.txt');}else await _0x3ffcef['start'](),console['log']('Telegram\x20Session\x20loaded\x20successfully.');console['log']('Telegram\x20client\x20is\x20ready\x20and\x20listening\x20for\x20new\x20messages...'),_0x3ffcef['addHandler'](async _0x11ebef=>{if(_0x11ebef instanceof Raw['Updates']||_0x11ebef instanceof Raw['UpdatesCombined']){const {updates:_0x25e578,chats:_0x394f50}=_0x11ebef;for(const _0x2990f8 of _0x25e578){if(_0x2990f8 instanceof Raw['UpdateNewChannelMessage']){const _0x56ad44=_0x394f50['find'](_0x539eb6=>_0x539eb6['username']===signalChannel);if(_0x56ad44){const _0x45c8af=_0x2990f8['message']['message'],_0x5ba574=parseMessage(_0x45c8af);if(_0x5ba574){console['log']('Received\x20a\x20new\x20signal:',JSON['stringify'](_0x5ba574,null,0x2));try{await placeBet(_0x3ca9ab,_0x5ba574);}catch(_0xeaf12b){console['error']('Error\x20placing\x20bet:',_0xeaf12b);}}}}}}});}catch(_0x318086){console['error']('An\x20error\x20occurred:',_0x318086);}finally{_0x1c7bac['close']();}}module['exports']={'startTelegramClient':startTelegramClient};